# BizAI 사용자 플로우 (User Flow)

## 1. 로그인 및 초기 진입

### 1.1 로그인 전 (비인증 사용자)
```
랜딩 페이지 (/landing)
├─ 앱 소개 및 기능 설명
├─ "Manus OAuth로 로그인" 버튼 클릭
└─ → Manus OAuth 인증 화면으로 리다이렉트
```

### 1.2 로그인 후 (인증 완료)
```
Manus OAuth 콜백 (/api/oauth/callback)
├─ 사용자 정보 저장 (users 테이블)
├─ 세션 쿠키 발급
└─ → 대시보드로 자동 리다이렉트
```

---

## 2. 대시보드 (Dashboard)

### 2.1 대시보드 진입
```
대시보드 페이지 (/)
├─ 사이드바 네비게이션 표시
│  ├─ 대시보드 (현재 페이지)
│  ├─ 영업일지
│  ├─ 일정
│  ├─ 수주
│  ├─ 납품/매출
│  └─ 고객사
├─ 상단 헤더
│  ├─ 사용자 프로필
│  └─ 로그아웃 버튼
└─ 메인 콘텐츠 영역
   ├─ 2월 영업 현황 (KPI 카드 4개)
   │  ├─ 이번달 일지: 작성한 영업일지 수
   │  ├─ 예정 일정: 진행 중인 일정 수
   │  ├─ 진행 수주: 제안/협상 중인 수주 수
   │  └─ 2월 매출: 수금 완료된 매출액
   ├─ RECENT LOGS 섹션
   │  ├─ 최근 영업일지 5개 표시
   │  ├─ 각 항목: 요약 + 방문일자
   │  └─ "전체 보기" 링크 → 영업일지 목록
   └─ UPCOMING PROMISES 섹션
      ├─ 예정된 일정 5개 표시
      ├─ 각 항목: 제목 + 예정일시
      └─ "전체 보기" 링크 → 일정 관리
```

---

## 3. 영업일지 플로우 (Sales Logs)

### 3.1 영업일지 목록 조회
```
영업일지 페이지 (/sale-list)
├─ 검색 바
│  └─ 고객사명, 담당자명으로 검색 가능
├─ 필터 탭
│  ├─ 전체
│  ├─ 미분석 (AI 분석 전)
│  └─ 분석완료 (AI 분석 후)
├─ 영업일지 목록
│  ├─ 각 항목: 고객사 + 요약 + 방문일자 + 상태
│  └─ 클릭 → 상세 페이지로 이동
└─ FAB (Floating Action Button)
   └─ "일지 작성" 버튼
```

### 3.2 영업일지 작성 (핵심 플로우)
```
영업일지 작성 페이지 (/sale-list/regi)

【1단계】 음성 녹음 또는 텍스트 입력
├─ VoiceRecorder 컴포넌트
│  ├─ 🎤 녹음 시작 버튼 클릭
│  ├─ 마이크 권한 요청
│  ├─ 실시간 녹음 중 (웹 Audio API)
│  ├─ 🛑 녹음 중지 버튼 클릭
│  └─ 웹엠(WebM) 오디오 파일 생성
├─ 또는 텍스트 직접 입력
│  ├─ 고객사명 입력
│  ├─ 담당자명 입력
│  ├─ 방문 위치 입력
│  └─ 활동 내용 텍스트 입력
└─ 방문 날짜 선택

【2단계】 음성 파일 업로드 및 변환
├─ "제출" 버튼 클릭
├─ 프론트엔드: 오디오 파일을 FormData로 POST
│  └─ /api/upload-audio 엔드포인트
├─ 백엔드: 오디오 파일 S3 업로드
│  └─ storagePut(key, buffer, "audio/webm")
├─ 반환: { url, key } (S3 공개 URL)
└─ 프론트엔드: 음성 변환 요청
   └─ trpc.salesLogs.transcribe({ audioUrl })

【3단계】 Whisper API 음성 → 텍스트 변환
├─ 백엔드: transcribeAudio({ audioUrl, language: "ko" })
├─ Manus Built-in Forge API 호출
│  └─ Whisper 모델 (한국어 최적화)
├─ 반환: { text: "변환된 한국어 텍스트", language: "ko" }
└─ 프론트엔드: 변환된 텍스트 표시

【4단계】 LLM을 통한 자동 구조화 및 분석
├─ "AI 분석" 버튼 클릭
├─ 백엔드: trpc.salesLogs.analyze({ id })
├─ LLM 호출 (invokeLLM)
│  ├─ 시스템 프롬프트: "영업 활동 분석 전문가"
│  ├─ 사용자 입력: 변환된 텍스트
│  └─ JSON 스키마로 구조화 요청
├─ LLM 반환 데이터:
│  ├─ clientName: "삼성전자" (추출된 고객사명)
│  ├─ contactPerson: "홍길동 부장" (담당자)
│  ├─ amount: 5000000 (예상 금액)
│  ├─ promises: [
│  │  {
│  │    title: "제안서 제출",
│  │    scheduledAt: "2026-03-03"
│  │  },
│  │  {
│  │    title: "계약 체결",
│  │    scheduledAt: "2026-03-10"
│  │  }
│  │]
│  ├─ nextActions: ["제안서 작성", "가격 협상"]
│  ├─ summary: "삼성전자와의 첫 미팅..."
│  ├─ keywords: ["제조", "납품", "협력사"]
│  └─ sentiment: "positive"
├─ 백엔드: 영업일지 업데이트
│  ├─ aiSummary, aiExtracted, isProcessed 저장
│  └─ clientName, contactPerson 자동 채우기
└─ 백엔드: 일정 자동 생성
   ├─ promises 배열의 각 항목마다 일정 레코드 생성
   ├─ isAutoGenerated: true 플래그
   └─ 프론트엔드에 "일정 2개 자동 생성됨" 알림

【5단계】 결과 확인 및 저장
├─ 프론트엔드: AI 분석 결과 표시
│  ├─ 추출된 고객사명
│  ├─ 추출된 담당자명
│  ├─ 예상 금액
│  ├─ 자동 생성된 일정 목록
│  ├─ AI 요약
│  └─ 키워드 태그
├─ 사용자: 필요시 수정 가능
└─ "저장" 버튼 → 영업일지 저장 완료
```

### 3.3 영업일지 상세 조회
```
영업일지 상세 페이지 (/sale-list/:id)
├─ 기본 정보
│  ├─ 고객사명
│  ├─ 담당자명
│  ├─ 방문 날짜
│  └─ 방문 위치
├─ 원본 콘텐츠
│  ├─ 음성 파일 재생 (있는 경우)
│  └─ 변환된 텍스트
├─ AI 분석 결과 (분석 완료 시)
│  ├─ AI 요약
│  ├─ 추출된 정보
│  │  ├─ 예상 금액
│  │  ├─ 다음 액션
│  │  └─ 감정 분석
│  ├─ 자동 생성 일정 목록
│  └─ 키워드 태그
├─ 첨부파일 (있는 경우)
└─ 액션 버튼
   ├─ 수정
   ├─ 삭제
   └─ 수주 등록 (빠른 이동)
```

---

## 4. 일정 관리 플로우 (Promises)

### 4.1 일정 목록 조회
```
일정 관리 페이지 (/sche-list)
├─ 상태별 탭
│  ├─ 전체
│  ├─ 진행 중 (pending)
│  ├─ 완료 (completed)
│  └─ 취소 (canceled)
├─ 일정 목록
│  ├─ 각 항목: 제목 + 고객사 + 예정일시 + 상태
│  └─ 클릭 → 상세 정보 표시 또는 수정
└─ FAB
   └─ "일정 추가" 버튼
```

### 4.2 일정 상태 변경
```
일정 항목 클릭
├─ 상태 변경 버튼 표시
│  ├─ 진행 중 → "완료" 버튼
│  ├─ 진행 중 → "취소" 버튼
│  └─ 완료/취소 → 상태 표시만
└─ 상태 변경 시
   ├─ 백엔드: updatePromise({ id, status })
   ├─ 일정 레코드 업데이트
   └─ 프론트엔드: 목록 자동 새로고침
```

### 4.3 일정 자동 생성 (영업일지 AI 분석 시)
```
영업일지 AI 분석 완료 후
├─ LLM이 추출한 promises 배열
├─ 각 일정마다:
│  ├─ createPromise({
│  │  userId,
│  │  salesLogId,
│  │  clientId,
│  │  clientName,
│  │  title,
│  │  scheduledAt,
│  │  isAutoGenerated: true
│  │})
│  └─ 일정 레코드 생성
└─ 프론트엔드: "일정 2개 자동 생성됨" 토스트 알림
```

---

## 5. 수주 관리 플로우 (Orders)

### 5.1 수주 목록 조회
```
수주 관리 페이지 (/orde-list)
├─ 상태별 탭
│  ├─ 전체
│  ├─ 제안 (proposal)
│  ├─ 협상 (negotiation)
│  ├─ 확정 (confirmed)
│  └─ 취소 (canceled)
├─ 요약 카드
│  ├─ 진행 중 수주: 제안 + 협상 건 수
│  └─ 진행 중 금액: 진행 중 수주의 합계 금액
├─ 수주 목록
│  ├─ 각 항목: 고객사 + 상품/서비스 + 금액 + 상태
│  └─ 클릭 → 상세 정보 표시
└─ FAB
   └─ "수주 등록" 버튼
```

### 5.2 수주 등록 (수동)
```
수주 등록 다이얼로그
├─ 고객사 선택 (드롭다운)
│  └─ 선택 시 고객사명 자동 채우기
├─ 상품/서비스명 입력
├─ 예상 금액 입력
├─ 상태 선택
│  ├─ 제안
│  ├─ 협상
│  └─ 확정
├─ 예상 확정일 선택
├─ 메모 입력
└─ "등록" 버튼
   ├─ 백엔드: createOrder({ ... })
   └─ 프론트엔드: 목록 새로고침
```

### 5.3 수주 상태 변경
```
수주 항목 클릭
├─ 상태 변경 버튼
│  ├─ 제안 → "협상 시작"
│  ├─ 협상 → "확정" / "제안으로 되돌리기"
│  ├─ 확정 → "취소"
│  └─ 취소 → 상태 변경 불가
└─ 상태 변경 시
   ├─ 백엔드: updateOrder({ id, status })
   ├─ 수주 레코드 업데이트
   ├─ 소유자 알림 (notifyOwner)
   │  └─ "수주 상태 변경: 삼성전자 - 제안 → 협상"
   └─ 프론트엔드: 목록 새로고침
```

---

## 6. 납품/매출 플로우 (Deliveries)

### 6.1 납품/매출 목록 조회
```
납품/매출 페이지 (/deliveries)
├─ 청구 상태별 탭
│  ├─ 전체
│  ├─ 미청구 (unbilled)
│  ├─ 청구완료 (billed)
│  └─ 수금완료 (paid)
├─ 요약 카드
│  ├─ 수금 완료: paid 상태의 총 매출액
│  └─ 미수금: unbilled + billed 상태의 총 금액
├─ 납품 목록
│  ├─ 각 항목: 고객사 + 금액 + 청구상태 + 납품상태
│  └─ 클릭 → 상세 정보 표시
└─ FAB
   └─ "납품 등록" 버튼
```

### 6.2 납품 등록
```
납품 등록 다이얼로그

【방법 1】 수주에서 빠른 등록
├─ 수주 상세 페이지에서 "납품 등록" 버튼
├─ 다이얼로그 자동 오픈
└─ 고객사명 + 금액 자동 채우기

【방법 2】 수동 등록
├─ 납품/매출 페이지 → "납품 등록" 버튼
├─ 연결 수주 선택 (선택사항)
│  └─ 선택 시 고객사명 + 금액 자동 채우기
├─ 고객사명 입력
├─ 매출 금액 입력
├─ 납품 상태 선택
│  ├─ 대기
│  ├─ 납품완료
│  ├─ 청구완료
│  └─ 수금완료
├─ 납품일 선택
├─ 메모 입력
└─ "등록" 버튼
   ├─ 백엔드: createDelivery({ ... })
   └─ 프론트엔드: 목록 새로고침
```

### 6.3 청구 상태 변경 (핵심 플로우)
```
납품 항목 클릭
├─ 미청구 상태
│  └─ "청구" 버튼 클릭
│     ├─ 백엔드: updateDelivery({ id, billingStatus: "billed" })
│     └─ 프론트엔드: 상태 변경 (미청구 → 청구완료)
├─ 청구완료 상태
│  └─ "수금" 버튼 클릭
│     ├─ 백엔드: updateDelivery({ id, billingStatus: "paid" })
│     ├─ 대시보드 KPI 업데이트
│     │  └─ "2월 매출" 금액 증가
│     └─ 프론트엔드: 상태 변경 (청구완료 → 수금완료)
└─ 수금완료 상태
   └─ 상태 변경 불가 (최종 상태)
```

---

## 7. 고객사 관리 플로우 (Clients)

### 7.1 고객사 목록 조회
```
고객사 관리 페이지 (/clients)
├─ 검색 바
│  └─ 고객사명, 담당자명으로 검색
├─ 고객사 목록
│  ├─ 각 항목: 고객사명 + 업종 + 담당자명 + 연락처
│  └─ 클릭 → 상세 페이지로 이동
└─ FAB
   └─ "고객사 추가" 버튼
```

### 7.2 고객사 등록
```
고객사 등록 다이얼로그
├─ 고객사명 입력 (필수)
├─ 업종 입력
├─ 담당자명 입력
├─ 연락처 입력
├─ 이메일 입력
├─ 주소 입력
├─ 메모 입력
└─ "등록" 버튼
   ├─ 백엔드: createClient({ ... })
   └─ 프론트엔드: 목록 새로고침
```

### 7.3 고객사 상세 조회
```
고객사 상세 페이지 (/clients/:id)
├─ 고객사 정보
│  ├─ 고객사명
│  ├─ 업종
│  ├─ 담당자명
│  ├─ 연락처
│  ├─ 이메일
│  ├─ 주소
│  └─ 메모
├─ 통계
│  ├─ 영업일지: 이 고객사와의 영업일지 수
│  └─ 총 수주액: 이 고객사의 모든 수주 합계
├─ RECENT LOGS 섹션
│  ├─ 최근 영업일지 5개
│  └─ "전체" 링크 → 영업일지 목록 (필터: 고객사)
└─ ORDERS 섹션
   ├─ 이 고객사의 모든 수주
   ├─ 각 항목: 상품/서비스 + 금액 + 상태
   └─ 클릭 → 수주 상세 페이지
```

---

## 8. 전체 데이터 흐름 (End-to-End)

### 8.1 영업 활동 → 매출 전환 (완전한 플로우)
```
【Day 1】 현장 영업
└─ 영업사원이 고객사 방문
   ├─ 🎤 음성 녹음 시작
   ├─ "삼성전자 방문, 홍길동 부장과 미팅, 5천만원 규모 협력사 제안..."
   ├─ 🛑 녹음 중지
   └─ 앱에서 "제출" 버튼 클릭

【자동 처리】 AI 분석 및 데이터 구조화
├─ 음성 → 텍스트 변환 (Whisper)
│  └─ "삼성전자 방문, 홍길동 부장과 미팅..."
├─ 텍스트 → 구조화 (LLM)
│  ├─ clientName: "삼성전자"
│  ├─ contactPerson: "홍길동 부장"
│  ├─ amount: 50000000
│  └─ promises: [
│     {
│       title: "제안서 제출",
│       scheduledAt: "2026-03-03"
│     },
│     {
│       title: "계약 체결",
│       scheduledAt: "2026-03-10"
│     }
│  ]
└─ 일정 자동 생성
   ├─ "제안서 제출" (2026-03-03)
   └─ "계약 체결" (2026-03-10)

【Day 2】 영업일지 검토
└─ 영업사원이 대시보드 확인
   ├─ 영업일지 1개 추가됨
   ├─ 일정 2개 자동 생성됨
   └─ 수주 수동 등록 (또는 자동 생성 가능하도록 개선)

【Day 3-7】 제안 및 협상
├─ 일정 "제안서 제출" 완료 → 일정 상태 변경 (진행중 → 완료)
├─ 수주 상태 변경 (제안 → 협상)
└─ 소유자 알림: "수주 상태 변경: 삼성전자 - 제안 → 협상"

【Day 10】 계약 체결
├─ 일정 "계약 체결" 완료 → 일정 상태 변경 (진행중 → 완료)
├─ 수주 상태 변경 (협상 → 확정)
├─ 소유자 알림: "수주 확정: 삼성전자 5천만원"
└─ 대시보드 KPI 업데이트
   └─ "진행 수주" 카운트 증가

【Day 15】 납품 및 청구
├─ 영업사원이 "납품 등록" 버튼 클릭
├─ 수주에서 자동으로 고객사명 + 금액 채워짐
├─ 납품 상태: "납품완료"
├─ 청구 상태: "미청구"
└─ 납품/매출 페이지에 표시

【Day 20】 청구 처리
├─ 영업사원이 납품 항목에서 "청구" 버튼 클릭
├─ 청구 상태: "미청구" → "청구완료"
└─ 고객사에 인보이스 발송

【Day 30】 수금 완료
├─ 영업사원이 납품 항목에서 "수금" 버튼 클릭
├─ 청구 상태: "청구완료" → "수금완료"
├─ 대시보드 KPI 업데이트
│  └─ "2월 매출" 금액 증가 (5천만원)
└─ 완전한 영업 사이클 종료
```

---

## 9. 모바일 vs 데스크탑 UX 차이

### 9.1 네비게이션
| 구분 | 모바일 | 데스크탑 |
|------|--------|---------|
| 네비게이션 위치 | 화면 하단 (고정) | 화면 좌측 사이드바 (고정) |
| 표시 방식 | 아이콘만 표시 | 아이콘 + 텍스트 |
| 공간 활용 | 최소화 (모바일 화면 작음) | 여유있게 (데스크탑 화면 큼) |

### 9.2 FAB (Floating Action Button)
| 구분 | 모바일 | 데스크탑 |
|------|--------|---------|
| FAB 표시 | 화면 우하단 (고정) | 헤더 우상단 버튼 |
| 터치 편의성 | 엄지손가락 닿기 쉬운 위치 | 마우스 클릭 |

### 9.3 대화상자
| 구분 | 모바일 | 데스크탑 |
|------|--------|---------|
| 다이얼로그 크기 | 전체 화면 (스크롤 가능) | 중앙 모달 (고정 크기) |
| 입력 필드 | 스택 레이아웃 (세로) | 그리드 레이아웃 (가로) |

---

## 10. 핵심 기능 요약

| 기능 | 설명 | 자동화 여부 |
|------|------|-----------|
| 음성 녹음 | 마이크로 영업 활동 기록 | - |
| 음성 변환 | Whisper API로 한국어 텍스트 변환 | ✅ 자동 |
| AI 분석 | LLM으로 고객명/금액/일정 추출 | ✅ 자동 |
| 일정 생성 | AI 분석 결과로 일정 자동 등록 | ✅ 자동 |
| 상태 추적 | 일정/수주/납품 상태 관리 | 수동 |
| 소유자 알림 | 중요 수주 상태 변경 시 알림 | ✅ 자동 |
| KPI 대시보드 | 실시간 영업 현황 집계 | ✅ 자동 |

---

## 11. 사용자 여정 (Customer Journey)

```
비인증 사용자
    ↓
로그인 (Manus OAuth)
    ↓
대시보드 진입 (KPI 확인)
    ↓
영업일지 작성 (음성 녹음 또는 텍스트)
    ↓
AI 자동 분석 (고객명/금액/일정 추출)
    ↓
일정 자동 생성 (예정된 미팅 등록)
    ↓
수주 관리 (상태 추적: 제안 → 협상 → 확정)
    ↓
납품/매출 처리 (청구 → 수금)
    ↓
대시보드 KPI 업데이트 (월간 매출 증가)
    ↓
보고서 생성 (향후 기능)
```

---

## 12. 주요 UX 특징

1. **음성 우선 입력**: 현장에서 빠른 기록 가능
2. **AI 자동 구조화**: 수동 입력 최소화
3. **자동 일정 생성**: 일정 관리 자동화
4. **실시간 KPI**: 경영진 보고용 대시보드
5. **모바일 최적화**: 현장 영업에 최적
6. **청사진 테마**: 전문적이고 정밀한 이미지

